# @desc: Duplicate key deduplication

# @test: "a"
# @expect: second a

# @test: "b"
# @expect: b

# @test: "c"
# @expect: third c

# @test: "M-x"
# @expect: last meta-x

# @test: "SPC"
# @expect: space winner

# @test: "w a"
# @expect: second w-a

# @test: "w c"
# @expect: second w-c

# @test: "p x"
# @expect: third nested x

# @test: "p y"
# @expect: nested y

# @test: "t"
# @expect: chord t wins

# @test: "C-S-k"
# @expect: last C-S-k

# Test file for duplicate key deduplication
# Expected behavior: last definition wins

:delay 0

# Simple duplicates - 'c' should show "Third definition wins"
a "First definition" +write %{{first a}}
b "Some command" +write %{{b}}
c "First c" +write %{{first c}}
c "Second c" +write %{{second c}}
a "(wins) Second definition" +write %{{second a}}
c "(wins) Third definition" +write %{{third c}}

# Duplicates with modifiers - should keep "Last Meta-x"
M-x "First Meta-x" +write %{{first meta-x}}
M-x "(wins) Last Meta-x" +write %{{last meta-x}}

# Duplicates with special keys - should keep "Space winner"
SPC "First space" +write %{{first space}}
SPC "(wins) Second space" +write %{{space winner}}

# Duplicate prefixes - 'w' should have the second prefix definition
w "First prefix" {
    a "First w-a" +write %{{first w-a}}
    b "First w-b" +write %{{first w-b}}
}

w "(wins) Second prefix" {
    a "(wins) Second w-a" +write %{{second w-a}}
    c "(wins) Second w-c" +write %{{second w-c}}
}

# Duplicates within a prefix - should deduplicate nested chords too
p "Prefix with internal duplicates" {
    x "First nested x" +write %{{first nested x}}
    y "Some nested y" +write %{{nested y}}
    x "Second nested x" +write %{{second nested x}}
    x "(wins) Third nested x" +write %{{third nested x}}
}

# Mix of prefix and chord with same key - last wins
# This 't' chord should win over the prefix
t "Prefix t" {
    a "Inside t prefix" +write %{{t-a}}
}
t "(wins) Chord t" +write %{{chord t wins}}

# Multiple modifiers - C-S-k should show "Last ctrl-shift"
C-S-k "First ctrl-shift" +write %{{first C-S-k}}
C-S-k "(wins) Last ctrl-shift" +write %{{last C-S-k}}
